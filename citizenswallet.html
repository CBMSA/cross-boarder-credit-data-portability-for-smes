
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sadicoin Wallet â€” Full Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; margin:20px; background:#f6f9fc; }
    h1 { text-align:center; color:#2a4d8f; }
    .box { background:#fff; padding:16px; border-radius:8px; max-width:800px; margin:12px auto; box-shadow:0 3px 6px rgba(0,0,0,.08) }
    input, button, select { width:100%; padding:10px; margin:8px 0; font-size:14px; }
    button { cursor:pointer; background:#2a4d8f; color:#fff; border:none; border-radius:6px; }
    button:hover { background:#1c3360; }
    table { width:100%; border-collapse:collapse; margin-top:10px }
    th, td { padding:8px; border-bottom:1px solid #eee; text-align:left }
    .small { font-size:13px; color:#333 }
  </style>
</head>
<body>
  <h1>ðŸ’³ Sadicoin Wallet â€” USD Prototype</h1>

  <div class="box">
    <h3>Register</h3>
    <input id="r_name" placeholder="Name">
    <input id="r_email" placeholder="Email">
    <input id="r_phone" placeholder="Phone">
    <input id="r_pass" placeholder="Password" type="password">
    <button onclick="register()">Register (Get USD 200)</button>
  </div>

  <div class="box">
    <h3>Login</h3>
    <input id="l_email" placeholder="Email">
    <input id="l_pass" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
  </div>

  <div class="box">
    <h3>Wallet</h3>
    <pre id="wallet_info">Not logged in</pre>
    <button onclick="refreshWallet()">Refresh</button>
  </div>

  <div class="box">
    <h3>Send</h3>
    <input id="to_addr" placeholder="Recipient address">
    <input id="to_amt" placeholder="Amount (USD)" type="number">
    <button onclick="send()">Send</button>
    <pre id="send_res"></pre>
  </div>

  <div class="box">
    <h3>Transfer to Bank</h3>
    <input id="bank_acc" placeholder="Bank account number / IBAN">
    <select id="fx_currency"></select>
    <input id="fx_amount" placeholder="Amount (USD)" type="number">
    <button onclick="transferToBank()">Transfer to Bank</button>
    <pre id="bank_res"></pre>
  </div>

  <div class="box">
    <h3>Transactions</h3>
    <table id="tx_table">
      <thead><tr><th>TxId</th><th>Type</th><th>Amount</th><th>Currency</th><th>Status</th><th>When</th><th>PDF</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  const USERS_KEY = "sadi_users";
  const TXS_KEY = "sadi_txs";
  let currentUser = null;

  const currencySymbols = ["ZAR","USD","BWP","MZN","XDR","XAU"];
  const eodhdToken = "67b2d451e5b8a8.90504186";
  let fxRates = {};

  // Load exchange rates
  async function loadRates(){
    try{
      const resp = await fetch(`https://eodhd.com/api/real-time/USD.ZAR,USD.BWP,USD.MZN,USD.XDR,USD.XAU?api_token=${eodhdToken}&fmt=json`);
      const data = await resp.json();
      fxRates = { USD:1 };
      data.forEach(it=>{
        const cur = it.code.replace("USD","").replace(".FOREX","");
        fxRates[cur] = it.close;
      });
    }catch(e){
      console.warn("FX API failed, using fallback", e);
      fxRates = { USD:1, ZAR:19, BWP:13, MZN:63, XDR:0.72, XAU:0.00057 };
    }
    const sel = document.getElementById("fx_currency");
    sel.innerHTML = currencySymbols.map(c => `<option value="${c}">${c} (${fxRates[c]||'n/a'})</option>`).join("");
  }

  function getUsers(){ return JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }
  function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
  function getTxs(){ return JSON.parse(localStorage.getItem(TXS_KEY)) || []; }
  function saveTxs(t){ localStorage.setItem(TXS_KEY, JSON.stringify(t)); }

  function generateTxId(){ return "tx_" + Math.random().toString(36).substr(2,9); }

  function register(){
    const name = r_name.value, email = r_email.value.toLowerCase(), phone = r_phone.value, password = r_pass.value;
    if (!name||!email||!phone||!password) return alert("Fill all fields");
    let users = getUsers();
    if (users[email]) return alert("User exists!");
    users[email] = { name,email,phone,password,wallet:{ address:"0x"+Math.random().toString(16).substr(2,40), balance:200 }};
    saveUsers(users);
    alert("Registered! You got USD 200.");
  }

  function login(){
    const email = l_email.value.toLowerCase(), password = l_pass.value;
    let users = getUsers();
    if (!users[email] || users[email].password!==password) return alert("Invalid login");
    currentUser=email; refreshWallet(); loadTxs(); alert("Logged in");
  }

  function refreshWallet(){
    if (!currentUser){ wallet_info.innerText="Not logged in"; return; }
    let u=getUsers()[currentUser];
    wallet_info.innerText=`Address: ${u.wallet.address}\nBalance: USD ${u.wallet.balance.toFixed(2)}`;
  }

  function recordTx(type,amount,currency,status){
    const txs=getTxs();
    const tx={ TxId:generateTxId(), Type:type, Amount:amount, Currency:currency, Status:status, CreatedAt:new Date().toISOString(), User:currentUser };
    txs.push(tx); saveTxs(txs); loadTxs();
  }

  function send(){
    if (!currentUser) return alert("Login first");
    const to=to_addr.value, amt=parseFloat(to_amt.value);
    if(!to||isNaN(amt)) return alert("Fill fields");
    let users=getUsers(); let u=users[currentUser];
    if(u.wallet.balance<amt) return alert("Insufficient funds");
    u.wallet.balance-=amt; saveUsers(users);
    send_res.innerText=`Sent USD ${amt.toFixed(2)} to ${to}`;
    recordTx("Send",amt,"USD","Success");
    refreshWallet();
  }

  function transferToBank(){
    if (!currentUser) return alert("Login first");
    const acc=bank_acc.value, amt=parseFloat(fx_amount.value), cur=fx_currency.value;
    if(!acc||isNaN(amt)) return alert("Fill fields");
    let users=getUsers(); let u=users[currentUser];
    if(u.wallet.balance<amt) return alert("Insufficient funds");
    u.wallet.balance-=amt; saveUsers(users);
    const converted=(amt* (fxRates[cur]||1)).toFixed(2);
    bank_res.innerText=`Transferred ${amt} USD (~${converted} ${cur}) to bank account ${acc}`;
    recordTx("Bank Transfer",amt,cur,"Pending");
    refreshWallet();
  }

  function loadTxs(){
    if(!currentUser) return;
    const txs=getTxs().filter(t=>t.User===currentUser);
    const tbody=document.querySelector("#tx_table tbody");
    tbody.innerHTML="";
    txs.forEach(tx=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td class="small">${tx.TxId}</td>
        <td class="small">${tx.Type}</td>
        <td class="small">${tx.Amount.toFixed(2)}</td>
        <td class="small">${tx.Currency}</td>
        <td class="small">${tx.Status}</td>
        <td class="small">${new Date(tx.CreatedAt).toLocaleString()}</td>
        <td><button onclick="downloadPDF('${tx.TxId}')">PDF</button></td>`;
      tbody.appendChild(tr);
    });
  }

  async function downloadPDF(txid){
    const { jsPDF } = window.jspdf;
    const tx = getTxs().find(t=>t.TxId===txid);
    if(!tx) return alert("Tx not found");
    const doc=new jsPDF();
    doc.text("Sadicoin Wallet â€” Transaction Receipt",10,10);
    doc.text(`TxId: ${tx.TxId}`,10,20);
    doc.text(`Type: ${tx.Type}`,10,30);
    doc.text(`Amount: ${tx.Amount} ${tx.Currency}`,10,40);
    doc.text(`Status: ${tx.Status}`,10,50);
    doc.text(`Date: ${new Date(tx.CreatedAt).toLocaleString()}`,10,60);
    doc.save(`transaction-${tx.TxId}.pdf`);
  }

  // Init
  loadRates();
  setInterval(loadRates,1000*60*5);
</script>
</body>
</html>

