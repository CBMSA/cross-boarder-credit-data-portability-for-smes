
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SadiCoin Tech — Wallet Platform</title>

<!-- Ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<!-- QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- Firebase -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBge7tAYfXo3UwQoy9f-75LOzr-rOcO_9s",
    authDomain: "sadicoin-fa3d5.firebaseapp.com",
    projectId: "sadicoin-fa3d5",
    storageBucket: "sadicoin-fa3d5.firebasestorage.app",
    messagingSenderId: "83847964912",
    appId: "1:83847964912:web:e1e083fd0859660180fa35",
    measurementId: "G-9NME9PCGQW"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth();
  const db = getFirestore();

  window.firebaseApp = { auth, db }; // make global
</script>

<style>
  /* ... keep your previous CSS here ... */
  :root{
    --accent:#2dd4bf;
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#94a3b8;
    --accent-dark:#059669;
  }
  body{margin:0; font-family:Inter,system-ui,Arial; background:linear-gradient(180deg,#071026 0%,#0b1220 100%); color:#e6eef6}
  header{padding:20px 24px; display:flex; align-items:center; gap:12px}
  .logo{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),#00509e); box-shadow:0 6px 18px rgba(0,0,0,0.6);font-weight:700;color:#042a2b}
  .brand{font-weight:700; font-size:18px}
  main{max-width:1100px;margin:18px auto;padding:20px}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.6);}
  .muted{color:var(--muted);font-size:13px}
  button{background:var(--accent); color:#042a2b; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600}
  input,select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;width:100%}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  .small{font-size:13px;color:var(--muted)}
  .right{display:flex;flex-direction:column;gap:10px}
  footer{color:var(--muted);text-align:center;padding:18px 0}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}
  .qr-wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .qr { width:150px; height:150px; background:#fff; padding:8px; border-radius:8px; }
  .hidden{display:none}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}
  .small-rate{font-size:12px;color:var(--muted)}
  .min-exchange{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center}
  @media(max-width:900px){.grid{grid-template-columns:1fr}.qr{width:120px;height:120px}}
  #authModal{position:fixed;inset:0;background:linear-gradient(0deg,rgba(2,6,23,0.85),rgba(2,6,23,0.85));display:flex;align-items:center;justify-content:center;z-index:9999}
  .auth-card{width:100%;max-width:420px;background:#041021;padding:20px;border-radius:12px;box-shadow:0 18px 60px rgba(2,6,23,0.7)}
  .link-btn{background:transparent;color:var(--accent);border:1px dashed rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
<header>
  <div class="logo" aria-hidden>
    <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="11" fill="#ffffff"/>
      <text x="12" y="16" text-anchor="middle" font-family="Arial" font-weight="700" font-size="10" fill="#00509e">SDC</text>
    </svg>
  </div>
  <div>
    <div class="brand">SadiCoin Tech</div>
    <div class="muted">Wallet Platform — live (test first)</div>
  </div>
  <div style="margin-left:auto" id="topRightActions"></div>
</header>

<main>
  <!-- AUTH modal -->
  <div id="authModal">
    <div class="auth-card">
      <h2 style="margin:0 0 8px 0">Welcome to SadiCoin</h2>
      <p class="muted" style="margin:0 0 16px 0">Register or login to continue.</p>

      <div id="authForms">
        <div id="registerForm">
          <label for="regEmail">Email</label>
          <input id="regEmail" type="email" placeholder="you@example.com" />
          <label for="regPassword" style="margin-top:8px">Password</label>
          <input id="regPassword" type="password" placeholder="Create a password" />
          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="btnRegister">Register</button>
            <button class="link-btn" id="showLogin">Have an account? Login</button>
          </div>
        </div>

        <div id="loginForm" class="hidden">
          <label for="loginEmail">Email</label>
          <input id="loginEmail" type="email" placeholder="you@example.com" />
          <label for="loginPassword" style="margin-top:8px">Password</label>
          <input id="loginPassword" type="password" placeholder="Password" />
          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="btnLogin">Login</button>
            <button class="link-btn" id="showRegister">Back to register</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- App Body -->
  <div id="app" class="hidden">
    <div class="topbar">
      <div class="min-exchange">
        <span class="small-rate">FX USD/ZAR:</span>
        <strong id="fxRate" style="color:var(--accent);margin-left:6px">--</strong>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div class="small-rate" id="userEmail" style="margin-right:12px"></div>
        <button id="logoutBtn" class="link-btn" style="background:#061623;border:0;color:var(--accent)">Logout</button>
      </div>
    </div>
    <div class="grid">
      <!-- Wallet card left -->
      <div class="card">
        <h3>Wallet</h3>
        <div class="muted">Create a real on-chain wallet (stored encrypted in browser; optional upload to backend)</div>
        <div style="margin-top:12px">
          <label>Wallet address</label>
          <div id="walletAddress" class="small" style="word-break:break-all">Not created</div>

          <label style="margin-top:8px">SadiCoin Balance</label>
          <div id="walletBalance" class="small">0 SDC</div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="createWalletBtn">Create Wallet</button>
            <button id="exportKeystoreBtn" class="link-btn">Export Keystore</button>
          </div>
        </div>

        <hr style="margin:14px 0;border-color:rgba(255,255,255,0.02)">
        <h4>Send SadiCoin</h4>
        <label>Recipient address</label>
        <input id="sendAddress" placeholder="0x..." />
        <label style="margin-top:8px">Amount</label>
        <input id="sendAmount" type="number" placeholder="0.0" />
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="sendBtn">Send</button>
          <button id="genSendQR" class="link-btn">Generate Payment QR</button>
        </div>
        <div id="sendStatus" class="small" style="margin-top:8px;color:#c8f3e9"></div>

        <hr style="margin:14px 0;border-color:rgba(255,255,255,0.02)">
        <h4>Receive</h4>
        <div class="qr-wrap" style="margin-top:8px">
          <div id="receiveQr" class="qr"></div>
          <div style="flex:1">
            <div class="small">Show this QR to others or copy your address</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="copyAddrBtn" class="link-btn">Copy Address</button>
              <button id="showAddrBtn" class="link-btn">Show Full</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right card: Exchange/Swap/History -->
      <div class="card right">
        <h3>Exchange & Markets</h3>
        <div class="small" id="marketsSmall">Live crypto & forex below</div>
        <div style="margin-top:12px">
          <div id="ratesMin" class="small-rate"></div>
        </div>
        <hr style="margin:14px 0;border-color:rgba(255,255,255,0.02)">
        <h4>Swap (SDC ↔ Token)</h4>
        <label>Amount (SDC)</label>
        <input id="swapAmount" placeholder="0.0" />
        <label style="margin-top:8px">To token address</label>
        <input id="swapToToken" placeholder="0x..." />
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="swapBtn">Swap (via backend)</button>
          <button id="viewPoolBtn" class="link-btn">View Pool</button>
        </div>

        <hr style="margin:14px 0;border-color:rgba(255,255,255,0.02)">
        <h4>Transaction History</h4>
        <table>
          <thead><tr><th>When</th><th>Type</th><th>Amount</th><th>TxHash</th></tr></thead>
          <tbody id="txBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <footer>
    © Copyrights SadiCoin Tech 2025
  </footer>
</main>

<script type="module">
import { auth, db } from window.firebaseApp;

// ===== CONFIG =====
const POLYGON_RPC = "https://polygon-rpc.com/";
const SDC_CONTRACT = "0x3e6dB8977261B30Ea3Cc0408867912E8B6CeDC96";
const SDC_DECIMALS = 18;

const provider = new ethers.providers.JsonRpcProvider(POLYGON_RPC);
const sdcAbi = [
  "function balanceOf(address) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function transfer(address to, uint amount) returns (bool)"
];
const sdcContract = new ethers.Contract(SDC_CONTRACT, sdcAbi, provider);

// ===== UI elements =====
const authModal = document.getElementById("authModal");
const appDiv = document.getElementById("app");
const userEmailDiv = document.getElementById("userEmail");
const walletAddressDiv = document.getElementById("walletAddress");
const walletBalanceDiv = document.getElementById("walletBalance");
const txBody = document.getElementById("txBody");
const receiveQrWrap = document.getElementById("receiveQr");

// ===== Auth UI toggles =====
document.getElementById("showLogin").onclick = () => {
  document.getElementById("registerForm").classList.add("hidden");
  document.getElementById("loginForm").classList.remove("hidden");
};
document.getElementById("showRegister").onclick = () => {
  document.getElementById("loginForm").classList.add("hidden");
  document.getElementById("registerForm").classList.remove("hidden");
};

// ===== Firebase auth =====
document.getElementById("btnRegister").onclick = async () => {
  const email = document.getElementById("regEmail").value.trim();
  const pw = document.getElementById("regPassword").value;
  if (!email || !pw) return alert("Enter email & password");
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email, pw);
    startApp(userCred.user);
  } catch(err) { alert(err.message); }
};
document.getElementById("btnLogin").onclick = async () => {
  const email = document.getElementById("loginEmail").value.trim();
  const pw = document.getElementById("loginPassword").value;
  try {
    const userCred = await signInWithEmailAndPassword(auth, email, pw);
    startApp(userCred.user);
  } catch(err) { alert(err.message); }
};
document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
  location.reload();
};

// ===== Auto-login =====
onAuthStateChanged(auth, (user) => {
  if(user) startApp(user);
});

// ===== Wallet helpers =====
async function storeKeystoreFirebase(user, keystore) {
  await setDoc(doc(db,"wallets",user.uid), { keystore });
}
async function loadKeystoreFirebase(user) {
  const d = await getDoc(doc(db,"wallets",user.uid));
  return d.exists() ? d.data().keystore : null;
}

function generateReceiveQr(address) {
  receiveQrWrap.innerHTML = "";
  const qrEl = document.createElement("div");
  qrEl.id = "qrgen";
  receiveQrWrap.appendChild(qrEl);
  new QRCode(qrEl, { text:`ethereum:${address}`, width:150, height:150 });
}

document.getElementById("copyAddrBtn").onclick = async () => {
  const addr = (walletAddressDiv.innerText || "").trim();
  if(!addr || addr==="Not created") return alert("No wallet");
  await navigator.clipboard.writeText(addr);
  alert("Address copied");
};
document.getElementById("showAddrBtn").onclick = () => alert(walletAddressDiv.innerText);

document.getElementById("createWalletBtn").onclick = async () => {
  const user = auth.currentUser;
  if(!user) return alert("Not logged in");
  const pw = prompt("Enter password to encrypt keystore:");
  if(!pw) return alert("Password required");
  const wallet = ethers.Wallet.createRandom();
  const json = await wallet.encrypt(pw,{scrypt:{N:1<<14}});
  const keystore = JSON.parse(json);
  await storeKeystoreFirebase(user, keystore);
  walletAddressDiv.innerText = wallet.address;
  generateReceiveQr(wallet.address);
};

// ===== Start app =====
function startApp(user) {
  authModal.classList.add("hidden");
  appDiv.classList.remove("hidden");
  userEmailDiv.innerText = user.email;
}
</script>
</body>
</html>
