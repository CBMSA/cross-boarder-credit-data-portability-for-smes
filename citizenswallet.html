<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sadicoin Wallet (Full Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f6f9fc; margin: 0; padding: 20px; }
    h1 { color: #2a4d8f; }
    .box { background: #fff; padding: 20px; margin: 15px auto; max-width: 650px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
    input, button, select { width: 100%; margin: 6px 0; padding: 10px; font-size: 14px; }
    button { background: #2a4d8f; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1c3360; }
    pre { background: #eef6ff; padding: 10px; border-radius: 6px; font-size: 13px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #2a4d8f; color: #fff; }
  </style>
</head>
<body>
  <h1>ðŸ’³ Sadicoin Wallet Prototype</h1>

  <!-- Register -->
  <div class="box">
    <h3>Register</h3>
    <input id="r_name" placeholder="Name">
    <input id="r_email" placeholder="Email">
    <input id="r_phone" placeholder="Phone">
    <input id="r_pass" placeholder="Password" type="password">
    <button onclick="register()">Register (Get USD 200)</button>
  </div>

  <!-- Login -->
  <div class="box">
    <h3>Login</h3>
    <input id="l_email" placeholder="Email">
    <input id="l_pass" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
  </div>

  <!-- Wallet -->
  <div class="box">
    <h3>Wallet</h3>
    <pre id="wallet_info">Not logged in</pre>
    <button onclick="refreshWallet()">Refresh</button>
  </div>

  <!-- Send -->
  <div class="box">
    <h3>Send USD</h3>
    <input id="to_addr" placeholder="Recipient address">
    <input id="to_amt" placeholder="Amount (USD)" type="number">
    <button onclick="send()">Send</button>
    <pre id="send_res"></pre>
  </div>

  <!-- Bank Transfer -->
  <div class="box">
    <h3>Bank Transfer</h3>
    <input id="bank_name" placeholder="Bank Name">
    <input id="bank_acc" placeholder="Account Number / IBAN">
    <select id="bank_currency">
      <option value="ZAR">ZAR (South Africa)</option>
      <option value="BWP">BWP (Botswana)</option>
      <option value="MZN">MZN (Mozambique)</option>
      <option value="USD">USD</option>
    </select>
    <input id="bank_amt" placeholder="Amount (USD)" type="number">
    <button onclick="bankTransfer()">Transfer</button>
    <pre id="bank_res"></pre>
  </div>

  <!-- Transactions -->
  <div class="box">
    <h3>Transactions</h3>
    <table>
      <thead>
        <tr>
          <th>TxID</th><th>Type</th><th>Amount</th><th>Currency</th><th>Status</th><th>Date</th><th>Receipt</th>
        </tr>
      </thead>
      <tbody id="tx_table"></tbody>
    </table>
  </div>

  <!-- MoonPay -->
  <div class="box">
    <h3>MoonPay Swap</h3>
    <button onclick="openSwap()">Swap with MoonPay</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // ðŸ”‘ API Config
    const eodhdToken = "67b2d451e5b8a8.90504186";
    const currencySymbols = ["ZAR","USD","BWP","MZN","XDR","XAU"];

    // ðŸ”¹ Local simulation
    let users = JSON.parse(localStorage.getItem("users")||"[]");
    let currentUser = null;
    let rates = {};

    // âœ… Register
    function register() {
      const name=r_name.value,email=r_email.value,phone=r_phone.value,password=r_pass.value;
      if(!name||!email||!phone||!password) return alert("Fill all fields");
      if(users.find(u=>u.email===email)) return alert("User already exists!");
      const wallet={address:"0x"+Math.random().toString(16).substr(2,40),balance:200};
      users.push({name,email,phone,password,wallet,txs:[]});
      localStorage.setItem("users",JSON.stringify(users));
      alert("Registered successfully! You got USD 200.");
    }

    // âœ… Login
    function login() {
      const email=l_email.value,password=l_pass.value;
      const u=users.find(u=>u.email===email&&u.password===password);
      if(!u) return alert("Invalid credentials");
      currentUser=u; refreshWallet(); renderTx();
    }

    // âœ… Wallet
    async function refreshWallet() {
      if(!currentUser) return wallet_info.innerText="Not logged in";
      await fetchRates();
      let info=`Address: ${currentUser.wallet.address}\nBalance: USD ${currentUser.wallet.balance.toFixed(2)}\n\nLive FX:\n`;
      for(const c of currencySymbols){
        if(c==="USD") continue;
        let val=(currentUser.wallet.balance*(rates[c]||0)).toFixed(2);
        info+=`${c}: ${val}\n`;
      }
      wallet_info.innerText=info;
    }

    // âœ… Fetch Rates
    async function fetchRates() {
      try {
        const url=`https://eodhd.com/api/forex-rates?api_token=${eodhdToken}&fmt=json`;
        const res=await fetch(url); const data=await res.json();
        rates={};
        currencySymbols.forEach(c=>{
          if(c==="USD"){rates[c]=1;}
          else {
            let r=data.find(d=>d.ticker===`USD/${c}`);
            if(r) rates[c]=r.close;
          }
        });
      } catch(e){ console.error("FX error",e); }
    }

    // âœ… Send
    function send() {
      if(!currentUser) return alert("Login first");
      const to=to_addr.value,amt=parseFloat(to_amt.value);
      if(!to||isNaN(amt)) return alert("Fill all fields");
      if(currentUser.wallet.balance<amt) return alert("Insufficient funds");
      currentUser.wallet.balance-=amt;
      const tx=makeTx("SEND",amt,"USD","Success");
      currentUser.txs.push(tx); save(); renderTx(); refreshWallet();
      send_res.innerText=`Sent USD ${amt.toFixed(2)} to ${to}`;
    }

    // âœ… Bank Transfer
    function bankTransfer() {
      if(!currentUser) return alert("Login first");
      const bank=bank_name.value,acc=bank_acc.value,curr=bank_currency.value,amt=parseFloat(bank_amt.value);
      if(!bank||!acc||isNaN(amt)) return alert("Fill all fields");
      if(currentUser.wallet.balance<amt) return alert("Insufficient funds");
      const rate=rates[curr]||1, converted=(amt*rate).toFixed(2);
      currentUser.wallet.balance-=amt;
      const tx=makeTx("BANK_TRANSFER",amt,curr,"Pending");
      currentUser.txs.push(tx); save(); renderTx(); refreshWallet();
      bank_res.innerText=`Transfer of USD ${amt.toFixed(2)} (${converted} ${curr}) initiated to ${bank} - ${acc}`;
      setTimeout(()=>{ tx.status="Success"; save(); renderTx(); },3000); // simulate async
    }

    // âœ… Transaction Utility
    function makeTx(type,amount,currency,status){
      return {id:"TX"+Math.random().toString(36).substr(2,9).toUpperCase(),
              type,amount,currency,status,date:new Date().toLocaleString()};
    }

    function renderTx() {
      if(!currentUser) return;
      tx_table.innerHTML=currentUser.txs.map(tx=>
        `<tr>
          <td>${tx.id}</td>
          <td>${tx.type}</td>
          <td>${tx.amount}</td>
          <td>${tx.currency}</td>
          <td>${tx.status}</td>
          <td>${tx.date}</td>
          <td><button onclick="genPDF('${tx.id}')">PDF</button></td>
        </tr>`
      ).join("");
    }

    function save(){ localStorage.setItem("users",JSON.stringify(users)); }

    // âœ… PDF Receipts
    async function genPDF(id){
      const tx=currentUser.txs.find(t=>t.id===id);
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      doc.text("Sadicoin Wallet - Transaction Receipt",20,20);
      doc.text(`Transaction ID: ${tx.id}`,20,40);
      doc.text(`Type: ${tx.type}`,20,50);
      doc.text(`Amount: ${tx.amount} ${tx.currency}`,20,60);
      doc.text(`Status: ${tx.status}`,20,70);
      doc.text(`Date: ${tx.date}`,20,80);
      doc.save(`receipt_${tx.id}.pdf`);
    }

    // âœ… MoonPay
    function openSwap(){
      if(!currentUser) return alert("Login first");
      const usd=currentUser.wallet.balance;
      const url=`https://buy.moonpay.com?apiKey=pk_live_0UYBzlsyM4A3Adj47IQrOkRx6dCWB4k&currencyCode=usd&walletAddress=${currentUser.wallet.address}&baseCurrencyAmount=${usd}`;
      window.open(url,"_blank");
    }

    // Auto-refresh rates
    setInterval(fetchRates,300000);
  </script>
</body>
</html>

