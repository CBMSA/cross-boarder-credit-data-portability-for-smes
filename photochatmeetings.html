<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PhotoChat â€“ Anonymous Social</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {--bg:#f5f6f8;--card:#fff;--text:#111827;--muted:#6b7280;--accent:#0b5cff;}
[data-theme="dark"] {--bg:#0b0e11;--card:#1e2329;--text:#eaecef;--muted:#848e9c;--accent:#f0b90b;}
*{box-sizing:border-box}
body{margin:0;font-family:Inter;background:var(--bg);color:var(--text)}
header{height:56px;background:var(--card);border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between;padding:0 16px}
.app{display:flex;height:calc(100vh - 56px)}
.sidebar{width:64px;background:var(--card);border-right:1px solid #e5e7eb;display:flex;flex-direction:column;align-items:center}
.sidebar a, .sidebar button{background:none;border:none;font-size:20px;padding:12px;cursor:pointer;color:var(--muted);text-decoration:none}
.sidebar a:hover, .sidebar button:hover{color:var(--accent)}
main{flex:1;padding:16px;overflow:auto}
.page{display:none}.page.active{display:block}
.card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px}
input{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;margin-bottom:8px}
.chat-window{display:flex;flex-direction:column;height:50vh;overflow:auto;background:#f0f2f5;padding:8px;border-radius:12px}
.msg{max-width:70%;padding:10px;border-radius:12px;margin-bottom:6px;font-size:14px}
.msg.me{align-self:flex-end;background:#0b5cff;color:#fff}
.msg.them{align-self:flex-start;background:#e5e7eb}
button.primary{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
</style>
</head>

<body data-theme="light">

<header>
  <strong>PhotoChat</strong>
  <button onclick="toggleTheme()">ðŸŒ“</button>
</header>

<div class="app">

<aside class="sidebar">
  <button onclick="go('chat')"><i class="bi bi-chat"></i></button>

  <!-- PhotoChat link -->
  <a href="photochatsdc.html"><i class="bi bi-images"></i></a>

  <!-- Buy Likes / Boost -->
  <a href="sdc.html"><i class="bi bi-lightning-charge"></i></a>
</aside>

<main>

<section id="chat" class="page active">
  <div class="card">
    <h3>Anonymous Chat</h3>
    <div class="chat-window" id="chatWindow"></div>
    <input id="msgInput" placeholder="Type anonymouslyâ€¦">
    <button class="primary" onclick="sendMsg()">Send</button>
  </div>
</section>

</main>
</div>

<script>
/* ----------------- SUPABASE ----------------- */
const supabase = supabase.createClient(
  "https://jbhhfzbhcvzxtthhmfhz.supabase.co",
  "YOUR_PUBLIC_ANON_KEY"
);

/* ----------------- ANONYMOUS USER ----------------- */
function getAnonId(){
  let id = localStorage.getItem("anon_id");
  if(!id){
    id = crypto.randomUUID();
    localStorage.setItem("anon_id", id);
  }
  return id;
}
const anonUser = getAnonId();

/* ----------------- ROUTER ----------------- */
function go(p){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.getElementById(p).classList.add('active');
}

/* ----------------- THEME ----------------- */
function toggleTheme(){
  document.body.dataset.theme =
    document.body.dataset.theme==="dark"?"light":"dark";
}

/* ----------------- CHAT ----------------- */
const chatWindow = document.getElementById("chatWindow");

async function sendMsg(){
  const input = document.getElementById("msgInput");
  if(!input.value) return;

  await supabase.from("messages").insert({
    user: anonUser,
    text: input.value,
    time: new Date().toISOString()
  });

  input.value="";
}

async function initChat(){
  const { data } = await supabase.from("messages").select("*").order("time");
  data?.forEach(renderMsg);

  supabase.channel("chat")
    .on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},
      payload => renderMsg(payload.new)
    ).subscribe();
}

function renderMsg(msg){
  const d = document.createElement("div");
  d.className = msg.user===anonUser ? "msg me" : "msg them";
  d.textContent = msg.text;
  chatWindow.appendChild(d);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

initChat();
</script>

</body>
</html>