
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sadicoin Wallet</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.1/dist/web3.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
  h1 { color: #333; }
  button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  input { padding: 8px; margin: 5px; width: 300px; }
  .section { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h1>Sadicoin Wallet</h1>

<div class="section">
  <h3>Connect Wallet</h3>
  <button onclick="connectWallet()">Connect MetaMask</button>
  <p id="account">Account: Not connected</p>
</div>

<div class="section">
  <h3>Check Balance</h3>
  <input type="text" id="balanceAddress" placeholder="Enter address">
  <button onclick="getBalance()">Get Balance</button>
  <p id="balanceResult"></p>
</div>

<div class="section">
  <h3>Transfer Tokens</h3>
  <input type="text" id="transferTo" placeholder="Recipient address">
  <input type="text" id="transferAmount" placeholder="Amount (in tokens)">
  <button onclick="transferTokens()">Transfer</button>
  <p id="transferResult"></p>
</div>

<script>
// ====== CONFIGURATION ======
const CONTRACT_ADDRESS = "YOUR_CONTRACT_ADDRESS";
const CONTRACT_ABI = [
  // Citizens Wallet ABI
  {
    "inputs": [], "stateMutability": "nonpayable", "type": "constructor"
  },
  {"inputs": [], "name": "ECDSAInvalidSignature", "type": "error"},
  {"inputs": [{"internalType": "uint256","name": "length","type": "uint256"}],
   "name": "ECDSAInvalidSignatureLength","type": "error"},
  {"inputs": [{"internalType": "bytes32","name": "s","type": "bytes32"}],
   "name": "ECDSAInvalidSignatureS","type": "error"},
  {"inputs": [{"internalType": "address","name": "spender","type": "address"},
              {"internalType": "uint256","name": "allowance","type": "uint256"},
              {"internalType": "uint256","name": "needed","type": "uint256"}],
   "name": "ERC20InsufficientAllowance","type": "error"},
  {"inputs": [{"internalType": "address","name": "sender","type": "address"},
              {"internalType": "uint256","name": "balance","type": "uint256"},
              {"internalType": "uint256","name": "needed","type": "uint256"}],
   "name": "ERC20InsufficientBalance","type": "error"},
  {"inputs": [{"internalType": "address","name": "approver","type": "address"}],
   "name": "ERC20InvalidApprover","type": "error"},
  {"inputs": [{"internalType": "address","name": "receiver","type": "address"}],
   "name": "ERC20InvalidReceiver","type": "error"},
  {"inputs": [{"internalType": "address","name": "sender","type": "address"}],
   "name": "ERC20InvalidSender","type": "error"},
  {"inputs": [{"internalType": "address","name": "spender","type": "address"}],
   "name": "ERC20InvalidSpender","type": "error"},
  {"inputs": [{"internalType": "uint256","name": "deadline","type": "uint256"}],
   "name": "ERC2612ExpiredSignature","type": "error"},
  {"inputs": [{"internalType": "address","name": "signer","type": "address"},
              {"internalType": "address","name": "owner","type": "address"}],
   "name": "ERC2612InvalidSigner","type": "error"},
  {"inputs": [{"internalType": "address","name": "account","type": "address"},
              {"internalType": "uint256","name": "currentNonce","type": "uint256"}],
   "name": "InvalidAccountNonce","type": "error"},
  {"inputs": [], "name": "InvalidShortString","type": "error"},
  {"inputs": [{"internalType": "address","name": "owner","type": "address"}],
   "name": "OwnableInvalidOwner","type": "error"},
  {"inputs": [{"internalType": "address","name": "account","type": "address"}],
   "name": "OwnableUnauthorizedAccount","type": "error"},
  {"inputs": [{"internalType": "string","name": "str","type": "string"}],
   "name": "StringTooLong","type": "error"},
  {"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "owner","type": "address"},
                                 {"indexed": true,"internalType": "address","name": "spender","type": "address"},
                                 {"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],
   "name": "Approval","type": "event"},
  {"anonymous": false,"inputs": [], "name": "EIP712DomainChanged","type": "event"},
  {"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},
                                 {"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],
   "name": "OwnershipTransferred","type": "event"},
  {"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "from","type": "address"},
                                 {"indexed": true,"internalType": "address","name": "to","type": "address"},
                                 {"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],
   "name": "Transfer","type": "event"},
  {"inputs": [], "name": "decimals","outputs": [{"internalType": "uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
  {"inputs": [{"internalType":"address","name":"account","type":"address"}],
   "name": "balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"to","type":"address"},
             {"internalType":"uint256","name":"value","type":"uint256"}],
   "name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"from","type":"address"},
             {"internalType":"address","name":"to","type":"address"},
             {"internalType":"uint256","name":"value","type":"uint256"}],
   "name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],
   "name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}
];

// ====== WEB3 & CONTRACT ======
let web3;
let contract;
let account;

async function connectWallet() {
    if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            account = accounts[0];
            document.getElementById('account').innerText = "Account: " + account;
            contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
        } catch (err) {
            alert("Connection failed: " + err.message);
        }
    } else {
        alert("Please install MetaMask!");
    }
}

// ====== BACKEND ALCHMEY CALL ======
async function callAlchemy(method, params) {
    const response = await fetch('/alchemy', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ method, params })
    });
    const data = await response.json();
    return data.result;
}

// ====== GET BALANCE ======
async function getBalance() {
    const address = document.getElementById('balanceAddress').value || account;
    if (!address) return alert("No address provided!");
    
    try {
        const balance = await contract.methods.balanceOf(address).call();
        document.getElementById('balanceResult').innerText = `Balance: ${balance}`;
    } catch (err) {
        document.getElementById('balanceResult').innerText = "Error: " + err.message;
    }
}

// ====== TRANSFER TOKENS ======
async function transferTokens() {
    const to = document.getElementById('transferTo').value;
    const amount = document.getElementById('transferAmount').value;
    if (!to || !amount) return alert("Recipient and amount required!");
    if (!contract || !account) return alert("Connect your wallet first!");

    try {
        const tx = await contract.methods.transfer(to, amount).send({ from: account });
        document.getElementById('transferResult').innerText = "Transaction Success: " + tx.transactionHash;
    } catch (err) {
        document.getElementById('transferResult').innerText = "Error: " + err.message;
    }
}
</script>

</body>
</html>
