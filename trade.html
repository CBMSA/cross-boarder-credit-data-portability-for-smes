
<!DOCTYPE html>
<html>
<head>
    <title>SADIcoin Admin Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        #sidebar { min-width: 220px; height: 100vh; background: #343a40; color: #fff; }
        #sidebar .nav-link { color: #fff; }
        #sidebar .nav-link.active { background: #495057; }
        #content { margin-left: 230px; padding: 20px; }
        .dashboard-card { min-width: 200px; }
    </style>
</head>
<body>

     <header class="d-flex align-items-center justify-content-between mb-4">
    <img src="ChatGPT Image Sep 11, 2025, 03_15_36 PM.png" alt="SCB Logo" class="logo">
    <h3>SADC Wallet</h3>
  </header>
    
<div class="d-flex">
    <nav id="sidebar" class="flex-column p-3">
        <h3 class="mb-4">SADIcoin Admin</h3>
        <a href="#" class="nav-link active" onclick="showPage('dashboard')">Dashboard</a>
        <a href="#" class="nav-link" onclick="showPage('users')">Users</a>
        <a href="#" class="nav-link" onclick="showPage('transactions')">Transactions</a>
        <a href="#" class="nav-link" onclick="showPage('blocks')">Blocks</a>
        <a href="#" class="nav-link" onclick="showPage('settings')">Settings</a>
    </nav>
    <div id="content" class="flex-grow-1">
        <!-- Dashboard Page -->
        <div id="dashboardPage">
            <h2>Dashboard</h2>
            <div class="d-flex gap-3 flex-wrap mb-4">
                <div class="card dashboard-card">
                    <div class="card-body">
                        <h5 class="card-title">Total Supply</h5>
                        <p id="totalSupply" class="card-text">0</p>
                    </div>
                </div>
                <div class="card dashboard-card">
                    <div class="card-body">
                        <h5 class="card-title">Transactions</h5>
                        <p id="totalTx" class="card-text">0</p>
                    </div>
                </div>
                <div class="card dashboard-card">
                    <div class="card-body">
                        <h5 class="card-title">Wallets</h5>
                        <p id="totalWallets" class="card-text">0</p>
                    </div>
                </div>
            </div>
            <h4>Recent Activity</h4>
            <ul id="recentActivity" class="list-group"></ul>
        </div>

        <!-- Users Page -->
        <div id="usersPage" style="display:none;">
            <h2>Users</h2>
            <table class="table table-bordered">
                <thead>
                    <tr><th>Name</th><th>Email</th><th>Wallet</th><th>Balance</th><th>Status</th></tr>
                </thead>
                <tbody id="usersTable"></tbody>
            </table>
        </div>

        <!-- Transactions Page -->
        <div id="transactionsPage" style="display:none;">
            <h2>Transactions</h2>
            <table class="table table-bordered">
                <thead>
                    <tr><th>ID</th><th>Sender</th><th>Receiver</th><th>Amount</th><th>Status</th><th>Timestamp</th></tr>
                </thead>
                <tbody id="txTable"></tbody>
            </table>
        </div>

        <!-- Blocks Page -->
        <div id="blocksPage" style="display:none;">
            <h2>Blocks</h2>
            <table class="table table-bordered">
                <thead>
                    <tr><th>Block #</th><th>Hash</th><th>Tx Count</th><th>Timestamp</th></tr>
                </thead>
                <tbody id="blocksTable"></tbody>
            </table>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" style="display:none;">
            <h2>Settings</h2>
            <label>API Key</label>
            <input id="apiKey" type="text" class="form-control mb-2" placeholder="Enter API Key">
            <label>API Secret</label>
            <input id="apiSecret" type="password" class="form-control mb-2" placeholder="Enter API Secret">
            <button class="btn btn-danger mb-2" onclick="pauseNetwork()">Pause Network</button>
            <button class="btn btn-secondary mb-2" onclick="showApiKey()">Show API Key</button>
            <div id="apiKeyBox" style="display:none;">
                <input type="text" class="form-control" readonly>
            </div>
        </div>
    </div>
</div>
<script>
    const API_BASE = "https://broker-api.sandbox.alpaca.markets"; // Example sandbox

    function getAuthHeaders() {
        const key = document.getElementById('apiKey').value.trim();
        const secret = document.getElementById('apiSecret').value.trim();
        return {
            'APCA-API-KEY-ID': key,
            'APCA-API-SECRET-KEY': secret
        };
    }

    // Navigation
    function showPage(page) {
        ['dashboardPage','usersPage','transactionsPage','blocksPage','settingsPage'].forEach(p=>{
            document.getElementById(p).style.display = (p === page+'Page') ? '' : 'none';
        });
        Array.from(document.querySelectorAll('#sidebar .nav-link')).forEach(link => {
            link.classList.remove('active');
        });
        let navs = {dashboard:'Dashboard', users:'Users', transactions:'Transactions', blocks:'Blocks', settings:'Settings'};
        Array.from(document.querySelectorAll('#sidebar .nav-link')).forEach(link=>{
            if(link.innerText===navs[page]) link.classList.add('active');
        });
    }

    // Example: Fetch account info with API keys
    async function loadDashboard() {
        try {
            const res = await fetch(`${API_BASE}/v1/accounts`, {
                headers: getAuthHeaders()
            });
            const data = await res.json();

            document.getElementById('totalSupply').innerText = "Sandbox";
            document.getElementById('totalTx').innerText = data.status;
            document.getElementById('totalWallets').innerText = data.account_number;

            let ul = document.getElementById('recentActivity');
            ul.innerHTML = `<li class="list-group-item">ID: ${data.id}</li>`;
        } catch (err) {
            console.error(err);
            alert("Failed to fetch account: " + err);
        }
    }

    // Settings
    function pauseNetwork() {
        alert("Network paused (API call would go here)");
    }
    function showApiKey() {
        document.getElementById('apiKeyBox').style.display = '';
        document.querySelector('#apiKeyBox input').value = document.getElementById('apiKey').value;
    }

    // Initial load
    window.onload = function() {
        showPage('dashboard');
        loadDashboard();
    };
</script>
</body>
</html>



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sadicoin Treasures Wallet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f9f9f9; }
    .logo { height: 60px; }
    .card { margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .admin-panel { background: #f0f0f0; padding: 15px; border-radius: 5px; margin-top: 20px; }
    .tx-status { font-size: 0.9rem; color: #666; }
    .tx-success { color: #28a745; }
    .tx-error { color: #dc3545; }
    .address { font-family: monospace; font-size: 0.9rem; }
  </style>
</head>
<body>
  <header class="d-flex align-items-center justify-content-between mb-4">
    <img src="ChatGPT Image Sep 11, 2025, 03_15_36 PM.png" alt="SCB Logo" class="logo">
    <h3>SADC Wallet - Web3</h3>
  </header>

  <nav class="mb-4">
    <button id="connectBtn" class="btn btn-primary">Connect Wallet</button>
    <span id="account" class="ms-3 address"></span>
    <span id="network" class="ms-2 badge bg-secondary"></span>
  </nav>

  <div id="app" style="display:none;">
    <div class="card p-3 mb-3">
      <h5>Your SADI Balance</h5>
      <p id="tokenBalance">-</p>
      <p id="nativeBalance">-</p>
      <div class="mt-2">
        <p><strong>Current Tax Rate:</strong> <span id="currentTax">-</span>%</p>
        <p><strong>Treasury Address:</strong> <span id="treasuryAddress" class="address">-</span></p>
        <p><strong>Contract Owner:</strong> <span id="contractOwner" class="address">-</span></p>
      </div>
    </div>

    <div class="card p-3 mb-3">
      <h5>Transfer SADI</h5>
      <div class="mb-2">
        <label class="form-label">Recipient Address</label>
        <input id="to" class="form-control" placeholder="0x..."/>
      </div>
      <div class="mb-2">
        <label class="form-label">Amount (SADI)</label>
        <input id="amount" type="number" class="form-control" placeholder="0.0" step="0.000001"/>
      </div>
      <button id="sendBtn" class="btn btn-success w-100">Send</button>
      <div id="txStatus" class="tx-status mt-2"></div>
      <div id="qr" class="mt-2"></div>
    </div>

    <!-- Admin Panel (only visible to contract owner) -->
    <div id="adminPanel" class="admin-panel" style="display:none;">
      <h5>Admin Functions</h5>

      <div class="mb-3 p-3 bg-light rounded">
        <h6>Tax Settings</h6>
        <div class="row">
          <div class="col-md-6 mb-2">
            <label class="form-label">Current Tax Rate</label>
            <div class="input-group">
              <input id="currentTaxDisplay" class="form-control" disabled/>
              <span class="input-group-text">%</span>
            </div>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">New Tax Rate (%)</label>
            <div class="input-group">
              <input id="newTax" type="number" class="form-control" placeholder="e.g., 2" min="0" max="10"/>
              <span class="input-group-text">%</span>
              <button id="setTaxBtn" class="btn btn-warning">Update</button>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3 p-3 bg-light rounded">
        <h6>Treasury Management</h6>
        <div class="mb-2">
          <label class="form-label">Current Treasury</label>
          <input id="currentTreasuryDisplay" class="form-control address" disabled/>
        </div>
        <div class="input-group">
          <input id="newTreasury" class="form-control" placeholder="New treasury address (0x...)"/>
          <button id="setTreasuryBtn" class="btn btn-warning">Update Treasury</button>
        </div>
      </div>

      <div class="mb-3 p-3 bg-light rounded">
        <h6>Token Management</h6>
        <div class="row mb-2">
          <div class="col-md-5">
            <label class="form-label">Mint Tokens</label>
            <input id="mintTo" class="form-control" placeholder="Recipient (0x...)"/>
          </div>
          <div class="col-md-5">
            <input id="mintAmount" type="number" class="form-control" placeholder="Amount" step="0.000001"/>
          </div>
          <div class="col-md-2 d-grid">
            <button id="mintBtn" class="btn btn-warning">Mint</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-5">
            <label class="form-label">Burn Tokens</label>
            <input id="burnFrom" class="form-control" placeholder="Address (0x...)"/>
          </div>
          <div class="col-md-5">
            <input id="burnAmount" type="number" class="form-control" placeholder="Amount" step="0.000001"/>
          </div>
          <div class="col-md-2 d-grid">
            <button id="burnBtn" class="btn btn-warning">Burn</button>
          </div>
        </div>
      </div>

      <div class="mb-3 p-3 bg-light rounded">
        <h6>Ownership</h6>
        <div class="d-flex justify-content-between">
          <div>
            <p class="mb-1"><strong>Current Owner:</strong> <span id="ownerAddress" class="address">-</span></p>
          </div>
          <div>
            <button id="renounceBtn" class="btn btn-danger btn-sm">Renounce Ownership</button>
          </div>
        </div>
        <div class="mt-2">
          <div class="input-group">
            <input id="newOwner" class="form-control" placeholder="New owner address (0x...)"/>
            <button id="transferOwnershipBtn" class="btn btn-warning">Transfer Ownership</button>
          </div>
        </div>
      </div>

      <div id="adminStatus" class="tx-status mt-2"></div>
    </div>

    <div class="card p-3 mb-3">
      <h5>Market Data</h5>
      <button id="priceBtn" class="btn btn-outline-primary mb-2">Get 1 SADI â†’ ZAR (CoinMarketCap)</button>
      <div id="cmcResult"></div>
      <button id="ratesBtn" class="btn btn-outline-secondary mt-2">Get Live Exchange Rates</button>
      <div id="ratesResult"></div>
    </div>
  </div>

  <footer class="mt-5 text-center">
    <p>&copy; 2025 SCB - SadiCoin</p>
  </footer>

<script>
// ========== CONFIGURATION ==========
const CONFIG = {
  CONTRACT_ADDRESS: "0xYourDeployedContractAddressHere", // REPLACE WITH YOUR CONTRACT ADDRESS
  CHAIN_ID: 80001, // Mumbai testnet (change to match your network)
  TOKEN_DECIMALS: 18,
  MOONPAY_PUBLISHABLE: "pk_live_0UYBzlsyM4A3Adj47IQrOkRx6dCWB4k" // Replace with your MoonPay key
};

// Full ABI for SadiCoin (including Ownable, ERC20, and custom functions)
const tokenAbi = [
  // ===== Ownable Functions =====
  {
    "inputs": [
      {"internalType": "address", "name": "owner", "type": "address"}
    ],
    "name": "OwnableInvalidOwner",
    "type": "error"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "account", "type": "address"}
    ],
    "name": "OwnableUnauthorizedAccount",
    "type": "error"
  },
  {
    "anonymous": false,
    "inputs": [
      {"indexed": true, "internalType": "address", "name": "previousOwner", "type": "address"},
      {"indexed": true, "internalType": "address", "name": "newOwner", "type": "address"}
    ],
    "name": "OwnershipTransferred",
    "type": "event"
  },
  {
    "inputs": [],
    "name": "owner",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "renounceOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "address", "name": "newOwner", "type": "address"}],
    "name": "transferOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },

  // ===== ERC20 Standard Functions =====
  {
    "inputs": [
      {"internalType": "address", "name": "spender", "type": "address"},
      {"internalType": "uint256", "name": "allowance", "type": "uint256"},
      {"internalType": "uint256", "name": "needed", "type": "uint256"}
    ],
    "name": "ERC20InsufficientAllowance",
    "type": "error"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "sender", "type": "address"},
      {"internalType": "uint256", "name": "balance", "type": "uint256"},
      {"internalType": "uint256", "name": "needed", "type": "uint256"}
    ],
    "name": "ERC20InsufficientBalance",
    "type": "error"
  },
  {
    "inputs": [{"internalType": "address", "name": "approver", "type": "address"}],
    "name": "ERC20InvalidApprover",
    "type": "error"
  },
  {
    "inputs": [{"internalType": "address", "name": "receiver", "type": "address"}],
    "name": "ERC20InvalidReceiver",
    "type": "error"
  },
  {
    "inputs": [{"internalType": "address", "name": "sender", "type": "address"}],
    "name": "ERC20InvalidSender",
    "type": "error"
  },
  {
    "inputs": [{"internalType": "address", "name": "spender", "type": "address"}],
    "name": "ERC20InvalidSpender",
    "type": "error"
  },
  {
    "anonymous": false,
    "inputs": [
      {"indexed": true, "internalType": "address", "name": "owner", "type": "address"},
      {"indexed": true, "internalType": "address", "name": "spender", "type": "address"},
      {"indexed": false, "internalType": "uint256", "name": "value", "type": "uint256"}
    ],
    "name": "Approval",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {"indexed": true, "internalType": "address", "name": "from", "type": "address"},
      {"indexed": true, "internalType": "address", "name": "to", "type": "address"},
      {"indexed": false, "internalType": "uint256", "name": "value", "type": "uint256"}
    ],
    "name": "Transfer",
    "type": "event"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "owner", "type": "address"},
      {"internalType": "address", "name": "spender", "type": "address"}
    ],
    "name": "allowance",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "spender", "type": "address"},
      {"internalType": "uint256", "name": "amount", "type": "uint256"}
    ],
    "name": "approve",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
    "name": "balanceOf",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "decimals",
    "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "name",
    "outputs": [{"internalType": "string", "name": "", "type": "string"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "symbol",
    "outputs": [{"internalType": "string", "name": "", "type": "string"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "totalSupply",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "to", "type": "address"},
      {"internalType": "uint256", "name": "amount", "type": "uint256"}
    ],
    "name": "transfer",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "from", "type": "address"},
      {"internalType": "address", "name": "to", "type": "address"},
      {"internalType": "uint256", "name": "amount", "type": "uint256"}
    ],
    "name": "transferFrom",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "nonpayable",
    "type": "function"
  },

  // ===== Custom SadiCoin Functions =====
  {
    "inputs": [],
    "name": "taxBasisPoints",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "treasury",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_bps", "type": "uint256"}],
    "name": "setTaxBps",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "address", "name": "_treasury", "type": "address"}],
    "name": "setTreasury",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "to", "type": "address"},
      {"internalType": "uint256", "name": "amount", "type": "uint256"}
    ],
    "name": "mint",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "from", "type": "address"},
      {"internalType": "uint256", "name": "amount", "type": "uint256"}
    ],
    "name": "burn",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },

  // ===== Custom Events =====
  {
    "anonymous": false,
    "inputs": [
      {"indexed": false, "internalType": "uint256", "name": "newBps", "type": "uint256"}
    ],
    "name": "TaxUpdated",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {"indexed": false, "internalType": "address", "name": "newTreasury", "type": "address"}
    ],
    "name": "TreasuryUpdated",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {"indexed": true, "internalType": "address", "name": "from", "type": "address"},
      {"indexed": true, "internalType": "address", "name": "to", "type": "address"},
      {"indexed": false, "internalType": "uint256", "name": "taxAmount", "type": "uint256"},
      {"indexed": false, "internalType": "uint256", "name": "netAmount", "type": "uint256"}
    ],
    "name": "TaxedTransfer",
    "type": "event"
  }
];

let provider, signer, account, tokenContract, isOwner = false;

async function init() {
  document.getElementById('connectBtn').onclick = connectWallet;
  document.getElementById('sendBtn').onclick = sendToken;
  document.getElementById('priceBtn').onclick = getCmcPrice;
  document.getElementById('ratesBtn').onclick = getRates;
  document.getElementById('setTaxBtn').onclick = setTaxRate;
  document.getElementById('setTreasuryBtn').onclick = setTreasuryAddress;
  document.getElementById('mintBtn').onclick = mintTokens;
  document.getElementById('burnBtn').onclick = burnTokens;
  document.getElementById('renounceBtn').onclick = renounceOwnership;
  document.getElementById('transferOwnershipBtn').onclick = transferOwnership;

  if (window.ethereum) {
    window.ethereum.on('chainChanged', handleChainChanged);
    window.ethereum.on('accountsChanged', handleAccountsChanged);
  }
}

async function connectWallet() {
  if (!window.ethereum) return alert("Please install MetaMask or another wallet");

  try {
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    account = accounts[0];
    document.getElementById('account').innerText = `${account.substring(0, 6)}...${account.substring(38)}`;

    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();

    const network = await provider.getNetwork();
    document.getElementById('network').innerText = getNetworkName(network.chainId);

    if (network.chainId !== CONFIG.CHAIN_ID) {
      alert(`Please switch to the correct network (Chain ID: ${CONFIG.CHAIN_ID})`);
      return;
    }

    tokenContract = new ethers.Contract(CONFIG.CONTRACT_ADDRESS, tokenAbi, provider);

    const owner = await tokenContract.owner();
    isOwner = (account.toLowerCase() === owner.toLowerCase());
    if (isOwner) {
      document.getElementById('adminPanel').style.display = 'block';
      document.getElementById('ownerAddress').innerText = `${owner.substring(0, 6)}...${owner.substring(38)}`;
      document.getElementById('currentTreasuryDisplay').value = await tokenContract.treasury();
      document.getElementById('currentTaxDisplay').value = (await tokenContract.taxBasisPoints()) / 100;
    }

    document.getElementById('contractOwner').innerText = `${owner.substring(0, 6)}...${owner.substring(38)}`;
    document.getElementById('app').style.display = 'block';
    refreshBalances();
    refreshContractInfo();

  } catch (err) {
    console.error(err);
    alert("Failed to connect wallet: " + (err.message || err));
  }
}

async function handleChainChanged() {
  window.location.reload();
}

async function handleAccountsChanged() {
  window.location.reload();
}

function getNetworkName(chainId) {
  const networks = {
    1: "Ethereum Mainnet",
    5: "Goerli",
    11155111: "Sepolia",
    137: "Polygon Mainnet",
    80001: "Polygon Mumbai",
    56: "BSC",
    97: "BSC Testnet",
    43114: "Avalanche",
    43113: "Avalanche Fuji"
  };
  return networks[chainId] || `Unknown (${chainId})`;
}

async function refreshBalances() {
  try {
    const bal = await provider.getBalance(account);
    document.getElementById('nativeBalance').innerText = `Native: ${ethers.formatEther(bal)}`;

    const rawBalance = await tokenContract.balanceOf(account);
    const decimals = await tokenContract.decimals();
    const humanBalance = ethers.formatUnits(rawBalance, decimals);
    document.getElementById('tokenBalance').innerText = `${humanBalance} SADI`;
  } catch (err) {
    console.error(err);
    alert("Failed to fetch balances");
  }
}

async function refreshContractInfo() {
  try {
    const taxBps = await tokenContract.taxBasisPoints();
    const treasury = await tokenContract.treasury();
    document.getElementById('currentTax').innerText = (taxBps / 100).toFixed(2);
    document.getElementById('treasuryAddress').innerText = `${treasury.substring(0, 6)}...${treasury.substring(38)}`;
  } catch (err) {
    console.error(err);
  }
}

async function sendToken() {
  const to = document.getElementById('to').value.trim();
  const amount = document.getElementById('amount').value.trim();

  if (!ethers.isAddress(to)) {
    showTxStatus("Invalid recipient address", "error");
    return;
  }

  if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
    showTxStatus("Invalid amount", "error");
    return;
  }

  try {
    showTxStatus("Processing transaction...", "pending");

    const decimals = await tokenContract.decimals();
    const amountWei = ethers.parseUnits(amount, decimals);

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.transfer(to, amountWei);

    showTxStatus(`Transaction sent: ${tx.hash}`, "pending");
    const receipt = await tx.wait();

    showTxStatus(`Transaction confirmed! Hash: ${receipt.hash}`, "success");
    document.getElementById('qr').innerHTML = "";
    new QRCode(document.getElementById('qr'), receipt.transactionHash);

    refreshBalances();
  } catch (err) {
    console.error(err);
    showTxStatus(`Error: ${err.message || err}`, "error");
  }
}

async function setTaxRate() {
  const newTax = document.getElementById('newTax').value.trim();

  if (!newTax || isNaN(newTax) || parseFloat(newTax) < 0 || parseFloat(newTax) > 10) {
    showAdminStatus("Invalid tax rate (0-10%)", "error");
    return;
  }

  try {
    showAdminStatus("Updating tax rate...", "pending");

    const taxBps = Math.floor(parseFloat(newTax) * 100);
    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.setTaxBps(taxBps);

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Tax rate updated successfully!", "success");
    refreshContractInfo();
    document.getElementById('currentTaxDisplay').value = newTax;
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

async function setTreasuryAddress() {
  const newTreasury = document.getElementById('newTreasury').value.trim();

  if (!ethers.isAddress(newTreasury)) {
    showAdminStatus("Invalid treasury address", "error");
    return;
  }

  try {
    showAdminStatus("Updating treasury address...", "pending");

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.setTreasury(newTreasury);

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Treasury address updated successfully!", "success");
    refreshContractInfo();
    document.getElementById('currentTreasuryDisplay').value = newTreasury;
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

async function mintTokens() {
  const to = document.getElementById('mintTo').value.trim();
  const amount = document.getElementById('mintAmount').value.trim();

  if (!ethers.isAddress(to)) {
    showAdminStatus("Invalid recipient address", "error");
    return;
  }

  if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
    showAdminStatus("Invalid amount", "error");
    return;
  }

  try {
    showAdminStatus("Minting tokens...", "pending");

    const decimals = await tokenContract.decimals();
    const amountWei = ethers.parseUnits(amount, decimals);

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.mint(to, amountWei);

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Tokens minted successfully!", "success");
    refreshBalances();
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

async function burnTokens() {
  const from = document.getElementById('burnFrom').value.trim();
  const amount = document.getElementById('burnAmount').value.trim();

  if (!ethers.isAddress(from)) {
    showAdminStatus("Invalid address", "error");
    return;
  }

  if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
    showAdminStatus("Invalid amount", "error");
    return;
  }

  try {
    showAdminStatus("Burning tokens...", "pending");

    const decimals = await tokenContract.decimals();
    const amountWei = ethers.parseUnits(amount, decimals);

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.burn(from, amountWei);

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Tokens burned successfully!", "success");
    refreshBalances();
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

async function renounceOwnership() {
  if (!confirm("Are you sure you want to renounce ownership? This cannot be undone.")) {
    return;
  }

  try {
    showAdminStatus("Renouncing ownership...", "pending");

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.renounceOwnership();

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Ownership renounced successfully!", "success");
    window.location.reload();
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

async function transferOwnership() {
  const newOwner = document.getElementById('newOwner').value.trim();

  if (!ethers.isAddress(newOwner)) {
    showAdminStatus("Invalid address", "error");
    return;
  }

  try {
    showAdminStatus("Transferring ownership...", "pending");

    const tokenWithSigner = tokenContract.connect(signer);
    const tx = await tokenWithSigner.transferOwnership(newOwner);

    showAdminStatus(`Transaction sent: ${tx.hash}`, "pending");
    await tx.wait();

    showAdminStatus("Ownership transferred successfully!", "success");
    window.location.reload();
  } catch (err) {
    console.error(err);
    showAdminStatus(`Error: ${err.message || err}`, "error");
  }
}

function showTxStatus(message, type) {
  const element = document.getElementById('txStatus');
  element.textContent = message;
  element.className = `tx-status mt-2 tx-${type}`;
}

function showAdminStatus(message, type) {
  const element = document.getElementById('adminStatus');
  element.textContent = message;
  element.className = `tx-status mt-2 tx-${type}`;
}

// Market data functions (placeholder - implement with your backend)
async function getCmcPrice() {
  document.getElementById('cmcResult').innerText = "1 SADI = ZAR 15.25 (Mock Data)";
}

async function getRates() {
  const mockRates = {
    USDZAR: 18.5,
    EURZAR: 19.8,
    GBPZAR: 22.3
  };
  const container = document.getElementById('ratesResult');
  container.innerHTML = '';
  for (const [key, value] of Object.entries(mockRates)) {
    const p = document.createElement('p');
    p.innerText = `${key}: ${value}`;
    container.appendChild(p);
  }
}

init();
</script>
</body>
</html>
