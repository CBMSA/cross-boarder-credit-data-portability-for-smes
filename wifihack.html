
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wi-Fi Monitor â€” Serverless Demo</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: sans-serif; background: #f0f2f5; }
.card { background:white; border-radius:16px; box-shadow:0 6px 18px rgba(15,23,42,0.06); padding:20px; margin-bottom:20px; }
.new-device { background: #fef3c7; }
</style>
</head>
<body class="p-6">
<h1 class="text-3xl font-bold mb-6">Wi-Fi Monitor (Serverless Demo)</h1>

<div class="card">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold">Connected Devices</h2>
    <button id="refresh" class="bg-blue-600 text-white px-3 py-1 rounded">Refresh</button>
  </div>
  <table class="w-full text-left">
    <thead>
      <tr>
        <th>IP</th>
        <th>MAC</th>
        <th>OS</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="device-list"></tbody>
  </table>
</div>

<div class="card">
  <h2 class="text-xl font-semibold mb-2">Activity Log</h2>
  <div id="log" class="text-sm text-gray-700 max-h-60 overflow-auto"></div>
</div>

<script>
// Device history in localStorage
let lastDevices = JSON.parse(localStorage.getItem('deviceHistory') || '[]');
let logLines = [];

// Simulate device scan
function simulateScan(){
  const mockDevices = [
    { ip:'192.168.1.10', mac:'AA:BB:CC:DD:01', os:'Windows' },
    { ip:'192.168.1.12', mac:'AA:BB:CC:DD:02', os:'Android' },
    { ip:'192.168.1.15', mac:'AA:BB:CC:DD:03', os:'Linux' }
  ];
  const now = new Date().toISOString();
  const devices = mockDevices.map(d=>{
    const existing = lastDevices.find(ld=>ld.mac===d.mac);
    return {...d, lastSeen: now, status: existing?'Existing':'New'};
  });
  return devices;
}

function addLog(msg){
  const ts = new Date().toLocaleTimeString();
  logLines.unshift(`[${ts}] ${msg}`);
  if(logLines.length>200) logLines.pop();
  document.getElementById('log').innerHTML = logLines.map(l=>`<div>${l}</div>`).join('');
}

function renderDevices(devices){
  if(!devices.length){
    document.getElementById('device-list').innerHTML = '<tr><td colspan="4">No devices</td></tr>';
    return;
  }
  document.getElementById('device-list').innerHTML = devices.map(d=>{
    const cls = d.status==='New'?'new-device':'';
    if(d.status==='New') addLog(`New device detected: ${d.ip} (${d.mac}) [${d.os}]`);
    return `<tr class="${cls}">
      <td>${d.ip}</td>
      <td>${d.mac}</td>
      <td>${d.os}</td>
      <td>${d.status}</td>
    </tr>`;
  }).join('');
  // Save to localStorage
  localStorage.setItem('deviceHistory', JSON.stringify(devices));
}

// Refresh handler
function refresh(){
  const devices = simulateScan();
  renderDevices(devices);
}

document.getElementById('refresh').onclick = refresh;

// Auto-refresh every 15s
setInterval(refresh, 15000);

// Initial load
refresh();
</script>
</body>
</html>
